title: PWAå­¦ä¹ æ€»ç»“
speaker: éƒ‘è¶…
transition: slide

[slide]

# PWAå­¦ä¹ æ€»ç»“

[slide]

# å£°æ˜
---
1. è¿™æ¬¡åˆ†äº«çš„ç›®çš„æ˜¯å‹¾èµ·å¤§å®¶å¯¹PWAçš„å…´è¶£ {:&.bounceIn}
2. ä¸ä¼šè®²å¤ªå¤šç»†èŠ‚ï¼ŒPWAé‡Œé¢å¾ˆå¤šæŠ€æœ¯ç‚¹è¦è®²å¾ˆæ¸…æ¥šå¯èƒ½éƒ½éœ€è¦ä¸¤ä¸‰ä¸ªå°æ—¶
3. é‡é˜³åé¢ä¼šå†åˆ†äº«ç»†èŠ‚ğŸ˜‚

[slide]

# å…ˆçœ‹[DEMO](https://arcane-garden-92807.herokuapp.com/)
---
1. ServiceWorker
2. CacheStorage

[slide]
<video src="/video/2.mp4" controls >

[slide]
<img src="/imgs/16.jpeg" />

[slide]
<img src="/imgs/17.jpeg" />

[slide]

# PWAæ˜¯ä»€ä¹ˆ

[slide]
[magic data-transition="zoomin"]
# Progressive Web Apps
====
# Progressive
====
# Progressive Enhancement
====
# Progressive Enhancement
---
* ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªä¼ ç»Ÿçš„Mobile Webï¼Œä½ æƒ³ä¼˜åŒ–å®ƒçš„ç”¨æˆ·ä½“éªŒï¼Œæ¯”æ–¹è¯´åœ¨2G/3Gå¼±ç½‘ç»œç¯å¢ƒä¸‹èƒ½å¤Ÿå¿«é€Ÿè®¿é—®ï¼Œå°±å¯ä»¥è€ƒè™‘ä½¿ç”¨[Cache API](https://developer.mozilla.org/en-US/docs/Web/API/Cache)æ¥åšç¼“å­˜æé«˜é‡å¤è®¿é—®çš„é€Ÿåº¦ã€‚ä½†åœ¨ä¸æ”¯æŒCache APIçš„ç»ˆç«¯ä¸‹ï¼Œç½‘ç«™å¯ä»¥èµ°ç½‘ç»œè¯·æ±‚ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚
====
# Progressive Web Apps
1. æŠ½è±¡åœ°è¯´ï¼šå…¨æ–°çš„Webåº”ç”¨æ¦‚å¿µï¼Œè®©Webæ›´å¯é ã€æ›´å¿«é€Ÿã€æœ‰ç±»ä¼¼Nativeä¸€æ ·çš„ç”¨æˆ·ä½“éªŒ {:&.bounceIn}
2. å…·ä½“åœ°è¯´ï¼šä»¥ServiceWorkerä¸ºæŠ€æœ¯æ ¸å¿ƒçš„ä¸€ç³»åˆ—æ–°çš„Web APIå’Œæ ‡å‡†åè®®([web push protocol](https://tools.ietf.org/html/draft-ietf-webpush-protocol-12))ï¼Œé€šè¿‡è¿™äº›æ–°åŠŸèƒ½ï¼Œå¯ä»¥è®©Webåº”ç”¨åšåˆ°ç¦»çº¿è®¿é—®ã€æ¶ˆæ¯æ¨é€ã€åå°åŒæ­¥ã€æ·»åŠ åˆ°æ‰‹æœºä¸»å±ç­‰åŠŸèƒ½

[/magic]

[slide]

# PWAä¸ºä»€ä¹ˆé‡è¦
---
æœ‰äººè¯´PWAå°†ä¼šå’ŒAJAXä¸€æ ·æ˜¯Webå¼€å‘é¢†åŸŸçš„é‡Œç¨‹ç¢‘æŠ€æœ¯ {:&.bounceIn}

[slide]
<img src="/imgs/3.jpeg">
---
<img src="/imgs/4.jpeg">

[slide]
![](https://jakearchibald.com/static/imgs/me.439a7c69520f.jpg)
---
[Jake Archibald](https://jakearchibald.com/)
---
* [Instant Loading: Building offline-first Progressive Web Apps - Google I/O 2016](https://www.youtube.com/watch?v=cmGr0RszHc8&list=WL&index=7&t=3s)

[slide]
<img src="/imgs/1.jpg">
[å¤©çŒ«è¶…å¸‚Mobile Webçš„æè‡´ä½“éªŒä¼˜åŒ–](https://tianchi.aliyun.com/forum/videoStream.html#postsId=3617)

[slide]
<img src="/imgs/5.jpg">

[slide]
<img src="/imgs/2.jpg">

[slide]

# æ€ä¹ˆå†™ä¸€ä¸ªPWA

[slide]
[Learn how to build a PWA in 5 minutes](https://medium.com/dev-channel/learn-how-to-build-a-pwa-in-under-5-minutes-c860ad406ed)

[slide]
<video src="/video/1.mp4" controls>

[slide]
# P0äº‹æ•…æ¥äº†
---
[PWA åœ¨é¥¿äº†ä¹ˆçš„å®è·µç»éªŒ](https://zhuanlan.zhihu.com/p/25800461)

[slide]
<img src="/imgs/6.jpg" />

[slide]
---
## Application Manifest
---
## ServiceWorker & Cache
---
## Web Push & Notification
---
## Background Sync
---

[slide]
---
## Application Manifest
---
1. å®ƒæ˜¯ä¸€ä¸ªJSONæ–‡ä»¶ï¼Œä¸€èˆ¬å‘½åä¸ºManifest.jsonï¼ŒåŒ…å«äº†ä¸€äº›é…ç½®ä¿¡æ¯ {:&.bounceIn}
2. è§¦å‘æµè§ˆå™¨å¼¹ä¸€ä¸ªå¯¹è¯æ¡†é—®ä½ æ˜¯å¦æ·»åŠ åº”ç”¨åˆ°æ‰‹æœºä¸»å±
3. å¯¹æ·»åŠ åˆ°æ‰‹æœºä¸»å±çš„Web Appåšä¸€äº›å¤–è§‚è®¾ç½®

[slide]

```json
{
  "short_name": "AirHorner",
  "name": "Kinlan's AirHorner of Infamy",
  "icons": [
    {
      "src": "launcher-icon-1x.png",
      "type": "image/png",
      "sizes": "48x48"
    },
    {
      "src": "launcher-icon-2x.png",
      "type": "image/png",
      "sizes": "96x96"
    },
    {
      "src": "launcher-icon-4x.png",
      "type": "image/png",
      "sizes": "192x192"
    }
  ],
  "start_url": "index.html?launcher=true"
}
```
[The Web App Manifest](https://developers.google.com/web/fundamentals/web-app-manifest/)

[slide]
<img src="/imgs/7.jpeg" />

[slide]
<img src="/imgs/8.jpeg" />

[slide]
<img src="https://developers.google.com/web/fundamentals/app-install-banners/images/add-to-home-screen.gif" />

[slide]
# å…³äºæ·»åŠ åˆ°ä¸»å±
<img src="/imgs/9.jpeg" />

[slide]
---
## ServiceWorker & Cache
---
1. å®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„Web Workerï¼Œåœ¨è¿™ä¸ªWorkeré‡Œå¯ä»¥ç›‘å¬ä¸€äº›ç‰¹æ®Šçš„äº‹ä»¶ï¼Œæ¯”å¦‚"fetch", "push", "sync"ç­‰ {:&.bounceIn}
2. å®ƒåœ¨åå°è¿è¡Œï¼Œä¸ä¼šå½±å“é¡µé¢ä¸»çº¿ç¨‹ï¼Œå¹¶ä¸”å³ä¾¿é¡µé¢å…³é—­ä¹Ÿä¼šå­˜åœ¨
3. æŠ€æœ¯ä¸Šå¤§é‡ä½¿ç”¨Promise

[slide]
# å¯ä»¥ç›‘å¬å“ªäº›äº‹ä»¶
<img src="/imgs/10.jpg" />

[slide]
# ServiceWorkerç”Ÿå‘½å‘¨æœŸ
<img src="/imgs/11.jpeg" />

[slide]
```javascript
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      // Registration was successful
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      // registration failed :(
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
```
[slide]
```javascript
var CACHE_NAME = 'my-site-cache-v1';
var urlsToCache = [
  '/',
  '/styles/main.css',
  '/script/main.js'
];

self.addEventListener('install', function(event) {
  // Perform install steps
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(function(cache) {
        console.log('Opened cache');
        return cache.addAll(urlsToCache);
      })
  );
});
```

[slide]
```javascript
self.addEventListener('activate', function(event) {

  var cacheWhitelist = ['pages-cache-v1', 'blog-posts-cache-v1'];

  event.waitUntil(
    caches.keys().then(function(cacheNames) {
      return Promise.all(
        cacheNames.map(function(cacheName) {
          if (cacheWhitelist.indexOf(cacheName) === -1) {
            return caches.delete(cacheName);
          }
        })
      );
    })
  );
});
```

[slide]
```javascript
self.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.match(event.request)
      .then(function(response) {
        // Cache hit - return response
        if (response) {
          return response;
        }
        return fetch(event.request);
      }
    )
  );
});
```

[slide]
```javascript
self.addEventListener('fetch', function(event) {
  event.respondWith(
    caches.match(event.request)
      .then(function(response) {
        // Cache hit - return response
        if (response) {
          return response;
        }
        // IMPORTANT: Clone the request. A request is a stream and
        // can only be consumed once. Since we are consuming this
        // once by cache and once by the browser for fetch, we need
        // to clone the response.
        var fetchRequest = event.request.clone();

        return fetch(fetchRequest).then(
          function(response) {
            var responseToCache = response.clone();

            caches.open(CACHE_NAME)
              .then(function(cache) {
                cache.put(event.request, responseToCache);
              });

            return response;
          }
        );
      })
    );
});
```
[slide]
# ç¼“å­˜ç­–ç•¥
---
1. Cache with network fallback {:&.bounceIn}
2. Cache only
3. Network only
4. Network with cache fallback
5. Cache, then network

[slide]
---
## Web Push & Notification
---
[slide]
<img src="/imgs/12.png">
[slide]
1. Push API {:&.bounceIn}
2. Notification API

[slide]
# Step 1
<img src="/imgs/13.jpeg" />

[slide]
# Step 2
<img src="/imgs/14.jpeg" />

[slide]
# Step 3
<img src="/imgs/15.jpeg" />


[slide]
---
## Background Sync
---
* æš‚æ—¶åªæœ‰Chrome 49+æ”¯æŒ {:&.bounceIn}

[slide]
[DEMO](https://www.youtube.com/watch?v=l4e_LFozK2k&feature=youtu.be)

[slide]
```javascript
if ('serviceWorker' in navigator && 'SyncManager' in window) {
  navigator.serviceWorker
    .register('./service-worker.js')
    .then(registration => navigator.serviceWorker.ready)
    .then(registration => { // register sync
      document.getElementById('requestButton').addEventListener('click', () => {
        registration.sync.register('image-fetch').then(() => {
            console.log('Sync registered');
        });
      });
    });
} else {
  document.getElementById('requestButton').addEventListener('click', () => {
    console.log('Fallback to fetch the image as usual');
  });
}
```

[slide]
```javascript
self.addEventListener('sync', function(event) {
  if (event.tag == 'image-fetch') {
    event.waitUntil(fetchDogImage());
  }
});
```
```javascript
function fetchDogImage () {
    fetch('./doge.png')
      .then(function (response) {
        return response;
      })
      .then(function (text) {
        console.log('Request successful', text);
      })
      .catch(function (error) {
        console.log('Request failed', error);
      });
  }
```

[slide]
# è°¢è°¢


